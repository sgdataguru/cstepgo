# StepperGO Database Schema - Visual Overview

A simplified visual representation of the StepperGO database architecture.

---

## ğŸ¨ Domain Architecture Visualization

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     STEPPERGO DATABASE ARCHITECTURE                      â•‘
â•‘                          PostgreSQL + Prisma ORM                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸ” USER & AUTH DOMAIN                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  User  â”‚â”€â”€â”€â”€â–¶â”‚ Session â”‚     â”‚ RefreshToken â”‚     â”‚ OTP â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜          â”‚
â”‚      â”‚                                                                   â”‚
â”‚      â”‚  Role: PASSENGER | DRIVER | ADMIN | ACTIVITY_OWNER              â”‚
â”‚      â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”
â”‚     ğŸš— DRIVER DOMAIN               â”‚   â”‚   ğŸ¯ ACTIVITY OWNER DOMAIN     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                    â”‚   â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Driver â”‚                        â”‚   â”‚  â”‚ ActivityOwner â”‚            â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                        â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚      â”‚                             â”‚   â”‚          â”‚                     â”‚
â”‚      â”œâ”€â–¶ Vehicle                   â”‚   â”‚          â”œâ”€â–¶ Activity          â”‚
â”‚      â”œâ”€â–¶ Review                    â”‚   â”‚          â”‚   â”œâ”€â–¶ ActivityPhotoâ”‚
â”‚      â”œâ”€â–¶ DriverLocation            â”‚   â”‚          â”‚   â”œâ”€â–¶ ActivityScheduleâ”‚
â”‚      â”œâ”€â–¶ DriverAvailabilityScheduleâ”‚   â”‚          â”‚   â”œâ”€â–¶ ActivityBookingâ”‚
â”‚      â”œâ”€â–¶ DriverAvailabilityHistory â”‚   â”‚          â”‚   â””â”€â–¶ ActivityReviewâ”‚
â”‚      â”œâ”€â–¶ DriverCredentialDelivery  â”‚   â”‚          â”‚                     â”‚
â”‚      â””â”€â–¶ Payout                    â”‚   â”‚          â”‚                     â”‚
â”‚                                    â”‚   â”‚          â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                            â”‚
       â”‚                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚            ğŸ—ºï¸ TRIP DOMAIN                       â”‚â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚                                                 â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”                                       â”‚â”‚
â”‚  â”‚ Trip â”‚                                       â”‚â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”€â”˜                                       â”‚â”‚
â”‚     â”‚                                           â”‚â”‚
â”‚     â”œâ”€â–¶ TripDriverVisibility                   â”‚â”‚
â”‚     â”œâ”€â–¶ TripAcceptanceLog                      â”‚â”‚
â”‚     â”œâ”€â–¶ Conversation                           â”‚â”‚
â”‚     â”‚    â””â”€â–¶ ConversationParticipant           â”‚â”‚
â”‚     â”‚    â””â”€â–¶ Message                           â”‚â”‚
â”‚     â””â”€â–¶ Booking                                â”‚â”‚
â”‚          â””â”€â–¶ Payment                           â”‚â”‚
â”‚                                                 â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
â”‚      ğŸ›¡ï¸ ADMIN & ANALYTICS DOMAIN             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                               â”‚
â”‚  â€¢ AnalyticsEvent   (tracking)               â”‚
â”‚  â€¢ AdminAction      (audit log)              â”‚
â”‚  â€¢ DocumentVerification                      â”‚
â”‚  â€¢ FileUpload                                â”‚
â”‚  â€¢ WebhookLog                                â”‚
â”‚  â€¢ Notification                              â”‚
â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— Relationship Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CORE RELATIONSHIPS                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User â”€â”€â”€â”€â”€1:1â”€â”€â”€â”€â–¶ Driver
     â”€â”€â”€â”€â”€1:1â”€â”€â”€â”€â–¶ ActivityOwner
     â”€â”€â”€â”€â”€1:1â”€â”€â”€â”€â–¶ DriverLocation
     â”€â”€â”€â”€â”€1:Mâ”€â”€â”€â”€â–¶ Session
     â”€â”€â”€â”€â”€1:Mâ”€â”€â”€â”€â–¶ Booking
     â”€â”€â”€â”€â”€1:Mâ”€â”€â”€â”€â–¶ Trip (as organizer)
     â”€â”€â”€â”€â”€1:Mâ”€â”€â”€â”€â–¶ ActivityBooking
     â”€â”€â”€â”€â”€1:Mâ”€â”€â”€â”€â–¶ Message

Driver â”€â”€â”€â”€1:Mâ”€â”€â”€â”€â–¶ Vehicle
       â”€â”€â”€â”€1:Mâ”€â”€â”€â”€â–¶ Review
       â”€â”€â”€â”€1:Mâ”€â”€â”€â”€â–¶ Trip (as driver)
       â”€â”€â”€â”€1:Mâ”€â”€â”€â”€â–¶ Payout

Trip â”€â”€â”€â”€â”€â”€1:Mâ”€â”€â”€â”€â–¶ Booking
     â”€â”€â”€â”€â”€â”€1:1â”€â”€â”€â”€â–¶ Conversation
     â”€â”€â”€â”€â”€â”€1:Mâ”€â”€â”€â”€â–¶ TripDriverVisibility
     â”€â”€â”€â”€â”€â”€1:Mâ”€â”€â”€â”€â–¶ TripAcceptanceLog

Booking â”€â”€â”€1:1â”€â”€â”€â”€â–¶ Payment

ActivityOwner â”€1:Mâ”€â–¶ Activity

Activity â”€â”€1:Mâ”€â”€â”€â”€â–¶ ActivityPhoto
         â”€â”€1:Mâ”€â”€â”€â”€â–¶ ActivitySchedule
         â”€â”€1:Mâ”€â”€â”€â”€â–¶ ActivityBooking
         â”€â”€1:Mâ”€â”€â”€â”€â–¶ ActivityReview

Conversation â”€1:Mâ”€â–¶ Message
             â”€1:Mâ”€â–¶ ConversationParticipant
```

---

## ğŸ“Š Model Count by Domain

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DOMAIN                 â”‚  MODELS    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  User & Auth            â”‚     4      â”‚
â”‚  Driver                 â”‚     7      â”‚
â”‚  Trip                   â”‚     3      â”‚
â”‚  Booking                â”‚     1      â”‚
â”‚  Payment & Payout       â”‚     2      â”‚
â”‚  Messaging              â”‚     3      â”‚
â”‚  Activity Owner         â”‚     6      â”‚
â”‚  Admin & Analytics      â”‚     6      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TOTAL                  â”‚    41      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Diagrams

### Passenger Booking Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Passenger  â”‚
â”‚   (User)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Creates Trip
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Trip     â”‚ â—€â”€â”€â”€â”€â”€â”€â”
â”‚  (DRAFT)    â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
       â”‚               â”‚
       â”‚ 2. Publishes  â”‚
       â–¼               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    Trip     â”‚        â”‚ 5. Driver Accepts
â”‚ (PUBLISHED) â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
       â”‚               â”‚
       â”‚ 3. Driver     â”‚
       â”‚    Discovery  â”‚
       â–¼               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚TripDriver   â”‚        â”‚
â”‚Visibility   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. Creates Booking
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Booking   â”‚
â”‚  (PENDING)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Payment
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Payment   â”‚
â”‚ (SUCCEEDED) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. Confirmed
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Booking   â”‚
â”‚ (CONFIRMED) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. Trip Completes
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Booking   â”‚
â”‚ (COMPLETED) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 8. Payout Settlement
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Payout    â”‚
â”‚   (PAID)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Activity Booking Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ActivityOwner â”‚
â”‚    (User)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Creates Activity
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Activity   â”‚
â”‚   (DRAFT)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Admin Approval
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Activity   â”‚
â”‚   (ACTIVE)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Passenger Browses
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Passenger   â”‚
â”‚    Books     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. Creates Booking
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ActivityBooking
â”‚ (CONFIRMED)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Completes Activity
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ActivityBooking
â”‚ (COMPLETED)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. Writes Review
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ActivityReviewâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Real-time Tracking Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Driver    â”‚
â”‚   Mobile    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ GPS Updates
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚DriverLocation
â”‚  (Real-time)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ WebSocket
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Passenger  â”‚
â”‚  Tracking   â”‚
â”‚   Screen    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Messaging Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Trip   â”‚
â”‚ Created  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Auto-create
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Conversation
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Add participants
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ConversationParticipantâ”‚
â”‚ â€¢ Organizer           â”‚
â”‚ â€¢ Driver              â”‚
â”‚ â€¢ Passengers          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Send messages
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Message  â”‚
â”‚  SENT    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Message  â”‚
â”‚DELIVERED â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Message  â”‚
â”‚   READ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° Revenue Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Passenger Pays  â”‚
â”‚   20,000 KZT     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Payment      â”‚
â”‚  (via Stripe)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                             â”‚
         â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Platform Fee    â”‚         â”‚  Driver Payout   â”‚
â”‚   3,000 KZT      â”‚         â”‚   17,000 KZT     â”‚
â”‚     (15%)        â”‚         â”‚     (85%)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚  Payout Model    â”‚
                             â”‚  (Aggregated)    â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Index Coverage Map

```
HIGH PRIORITY INDEXES (Performance Critical)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User Domain
â”œâ”€â”€ User.email              (Login)
â”œâ”€â”€ User.phone              (Auth)
â””â”€â”€ Session.token           (Validation)

Driver Domain
â”œâ”€â”€ Driver.availability     (Discovery)
â”œâ”€â”€ Driver.status           (Filtering)
â”œâ”€â”€ DriverLocation(lat,lng) (Geospatial)
â””â”€â”€ Driver.lastActivityAt   (Auto-offline)

Trip Domain
â”œâ”€â”€ Trip.status             (Lifecycle)
â”œâ”€â”€ Trip(originLat,originLng) (Search)
â”œâ”€â”€ Trip.departureTime      (Scheduling)
â””â”€â”€ Trip.acceptanceDeadline (Timeouts)

Booking Domain
â”œâ”€â”€ Booking.tripId          (Lookups)
â”œâ”€â”€ Booking.userId          (User history)
â””â”€â”€ Booking.payoutSettled   (Payouts)

Messaging Domain
â”œâ”€â”€ Message(conversationId,sentAt) (History)
â””â”€â”€ ConversationParticipant(userId) (Inbox)

Activity Domain
â”œâ”€â”€ Activity(status,publishedAt) (Listings)
â””â”€â”€ Activity(city,category)      (Search)
```

---

## ğŸ¯ Business Logic Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PLATFORM RULES                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Revenue Split:                                         â”‚
â”‚    Driver:    85%                                       â”‚
â”‚    Platform:  15%                                       â”‚
â”‚                                                         â”‚
â”‚  Payment Methods:                                       â”‚
â”‚    âœ“ ONLINE          (Stripe, included in payouts)     â”‚
â”‚    âœ“ CASH_TO_DRIVER  (Direct, excluded from payouts)   â”‚
â”‚                                                         â”‚
â”‚  Driver Discovery:                                      â”‚
â”‚    â€¢ Radius: 10km (default)                            â”‚
â”‚    â€¢ Timeout: 30 seconds                               â”‚
â”‚    â€¢ Status: AVAILABLE                                 â”‚
â”‚                                                         â”‚
â”‚  Seat Management:                                       â”‚
â”‚    â€¢ Private: All seats to one booking                 â”‚
â”‚    â€¢ Shared: Multiple bookings per trip                â”‚
â”‚                                                         â”‚
â”‚  Payout Eligibility:                                    â”‚
â”‚    âœ“ Payment method: ONLINE                            â”‚
â”‚    âœ“ Booking status: COMPLETED                         â”‚
â”‚    âœ“ Payment status: SUCCEEDED                         â”‚
â”‚    âœ“ Not settled: payoutSettled = false                â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± Model Size Reference

```
SMALL MODELS (< 10 fields)
â”œâ”€â”€ Session
â”œâ”€â”€ RefreshToken
â”œâ”€â”€ OTP
â”œâ”€â”€ TripDriverVisibility
â”œâ”€â”€ ConversationParticipant
â””â”€â”€ Message

MEDIUM MODELS (10-20 fields)
â”œâ”€â”€ User
â”œâ”€â”€ Trip
â”œâ”€â”€ Booking
â”œâ”€â”€ Payment
â”œâ”€â”€ Payout
â”œâ”€â”€ Vehicle
â”œâ”€â”€ Review
â””â”€â”€ ActivityPhoto

LARGE MODELS (> 20 fields)
â”œâ”€â”€ Driver           (40+ fields)
â”œâ”€â”€ Activity         (30+ fields)
â””â”€â”€ ActivityOwner    (20+ fields)
```

---

## ğŸ” Security Features

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SECURITY IMPLEMENTATION             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  Authentication:                            â”‚
â”‚    âœ“ bcrypt password hashing               â”‚
â”‚    âœ“ JWT with refresh tokens               â”‚
â”‚    âœ“ OTP verification                      â”‚
â”‚                                             â”‚
â”‚  Data Protection:                           â”‚
â”‚    âœ“ SHA-256 token hashing                 â”‚
â”‚    âœ“ Masked payment data (last 4)          â”‚
â”‚    âœ“ Secure file uploads                   â”‚
â”‚                                             â”‚
â”‚  Audit Trail:                               â”‚
â”‚    âœ“ AdminAction logs                      â”‚
â”‚    âœ“ IP address tracking                   â”‚
â”‚    âœ“ User agent logging                    â”‚
â”‚                                             â”‚
â”‚  Access Control:                            â”‚
â”‚    âœ“ Role-based permissions                â”‚
â”‚    âœ“ Multi-tenant isolation                â”‚
â”‚    âœ“ Document verification                 â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**For detailed documentation, see**:
- [Complete ER Diagram](./DATABASE_SCHEMA_ER_DIAGRAM.md)
- [Quick Reference](./DATABASE_SCHEMA_QUICK_REFERENCE.md)
- [Database README](./DATABASE_README.md)

---

**Last Updated**: November 26, 2025  
**Version**: 1.0
